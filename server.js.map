{"version":3,"file":"server.js","sources":["webpack:///webpack/bootstrap 6d2b9de9658b6174fa5d","webpack:///external \"mongoose\"","webpack:///external \"jsonwebtoken\"","webpack:///external \"bcrypt\"","webpack:///external \"express\"","webpack:///external \"path\"","webpack:///src/server/index.js","webpack:///external \"dotenv\"","webpack:///src/server/services/user/userModel.js","webpack:///src/server/app.js","webpack:///external \"body-parser\"","webpack:///src/server/routes/routes.js","webpack:///src/server/services/user/userController.js","webpack:///src/server/services/cdn/cdnController.js","webpack:///external \"source-map-support\""],"sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 5);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 6d2b9de9658b6174fa5d","module.exports = require(\"mongoose\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"mongoose\"\n// module id = 0\n// module chunks = 0","module.exports = require(\"jsonwebtoken\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"jsonwebtoken\"\n// module id = 1\n// module chunks = 0","module.exports = require(\"bcrypt\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"bcrypt\"\n// module id = 2\n// module chunks = 0","module.exports = require(\"express\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"express\"\n// module id = 3\n// module chunks = 0","module.exports = require(\"path\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"path\"\n// module id = 4\n// module chunks = 0","const mongoose = require('mongoose');\nconst jsonwebtoken = require('jsonwebtoken');\n\n// import environmental variables from our variables.env file\nrequire('dotenv').config({ path: 'variables.env' });\n\n// Connect to our Database and handle an bad connections\nmongoose.Promise = global.Promise; // Tell Mongoose to use ES6 promises\nmongoose.connect(process.env.DATABASE);\nmongoose.connection.on('error', err => {\n  console.error(`!!!!!!!ERROR!!!!!!! -> ${err.message}`);\n});\n\n// Invoke Models\nrequire('./services/user/userModel');\n\n\nconst app = require('./app');\napp.set('port', process.env.SERVER_PORT || 7777);\nconst server = app.listen(app.get('port'), () => {\n  console.log(`Express running -> PORT ${server.address().port}`);\n});\n\n\n\n// WEBPACK FOOTER //\n// src/server/index.js","module.exports = require(\"dotenv\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"dotenv\"\n// module id = 6\n// module chunks = 0","const mongoose = require('mongoose');\nconst bcrypt = require('bcrypt');\n\nconst UserSchema = mongoose.Schema({\n    username: {\n        type: String,\n        trim: true,\n        unique: true,\n        required: true\n    },\n    email: {\n        type: String,\n        unique: true,\n        lowercase: true,\n        trim: true,\n        required: true\n    },\n    hash_password: {\n        type: String\n    },\n    created: {\n        type: Date,\n        default: Date.now\n    }\n});\n\nUserSchema.methods.comparePassword = function(password) {\n    return bcrypt.compareSync(password, this.hash_password);\n}\n\nmongoose.model('User', UserSchema);\n\n\n// WEBPACK FOOTER //\n// src/server/services/user/userModel.js","const express = require('express');\nconst bodyParser = require('body-parser'); \nconst routes = require('./routes/routes');\nconst sourceMapSupport = require('source-map-support');\nconst path = require('path');\n\n\nif (process.env.BUILD_DEV) {\n    sourceMapSupport.install();\n}\n\nconst app = express();\n\napp.use(bodyParser.json());\napp.use(bodyParser.urlencoded({ extended: true }));\n\n// cdn middleware\napp.use('/download/assets', express.static(path.join(process.cwd(), 'assets')));\n\napp.use('/', routes);\n\n\nmodule.exports = app;\n\n\n// WEBPACK FOOTER //\n// src/server/app.js","module.exports = require(\"body-parser\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"body-parser\"\n// module id = 9\n// module chunks = 0","const router = require('express').Router();\n\nconst userController = require('@server/services/user/userController');\nconst cdnController = require('@server/services/cdn/cdnController');\n\nrouter.use(userController.decodeJWT);\n\n// user service\nrouter.post('/account/register', userController.register);\nrouter.post('/account/login', userController.login);\nrouter.get('/account/isloggedin', userController.isLoggedIn);\n\n// cdn service\nrouter.get('/download/:filename', cdnController.download);\n\n\n\nmodule.exports = router;\n\n\n// WEBPACK FOOTER //\n// src/server/routes/routes.js","const mongoose = require('mongoose');\nconst jwt = require('jsonwebtoken');\nconst bcrypt = require('bcrypt');\nconst User = mongoose.model('User');\n\nexports.register = (req, res) => {\n    let newUser = new User(req.body);\n    newUser.hash_password = bcrypt.hashSync(req.body.password, 10);\n    newUser.save()\n        .then(user => {\n            user.hash_password = undefined;\n            res.json(user);\n        })\n        .catch(err => res.status(400).json({\n            message: err\n        }));\n}\n\nexports.login = (req, res) => {\n    User.findOne({\n      email: req.body.email,\n      username: req.body.username\n    })\n    .then(user => {\n        if (!user || !user.comparePassword(req.body.password)) {\n            return res.status(401).json({ \n                message: 'Authentication failed. Invalid user or password.' \n            });\n        }\n        return res.json({ \n            token: jwt.sign({ \n                email: user.email, \n                username: user.username, \n                _id: user._id \n            }, 'secret_key') \n        });\n    })\n    .catch(console.error);\n};\n\n// not used\nexports.loginRequired = (req, res, next) => {\n    if (!req.user) {\n        return res.status(401).json({\n            message: 'You are not logged in !'\n        });\n    }\n    next();\n};\n\nexports.decodeJWT = (req, res, next) => {\n    if (req.headers && req.headers.authorization && req.headers.authorization.split(' ')[0] === 'JWT') {\n        jwt.verify(req.headers.authorization.split(' ')[1], 'secret_key', (err, decode) => {\n            if (err) req.user = undefined;\n            req.user = decode;\n            next();\n        });\n    } else {\n        req.user = undefined;\n        next();\n    } \n}\n\nexports.isLoggedIn = (req, res) => {\n    if (!req.user) {\n        return res.status(401).json({\n            isLoggedIn: false\n        });\n    }\n    res.json({\n        isLoggedIn: true\n    });\n}\n\n\n\n// WEBPACK FOOTER //\n// src/server/services/user/userController.js","const path = require('path');\n\nexports.download = (req, res, next) => {\n    res.download(path.resolve(process.cwd(), `dist/${req.params.filename}`), err => {\n        if (err) return next(err);\n        console.log(`${req.params.filename} sent`);\n    });\n}\n\n\n// WEBPACK FOOTER //\n// src/server/services/cdn/cdnController.js","module.exports = require(\"source-map-support\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"source-map-support\"\n// module id = 13\n// module chunks = 0"],"mappings":";;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;AC7DA;;;;;;ACAA;;;;;;ACAA;;;;;;ACAA;;;;;;ACAA;;;;;;;;;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;;;;;;ACrBA;;;;;;;;;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAJA;AAMA;AACA;AACA;AACA;AACA;AACA;AALA;AAOA;AACA;AADA;AAGA;AACA;AACA;AAFA;AAjBA;AACA;AAsBA;AACA;AACA;AACA;AACA;;;;;;;;;AC9BA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;;;;;ACtBA;;;;;;;;;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;;;;;;;;;ACjBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AADA;AAAA;AAGA;AACA;AACA;AACA;AACA;AACA;AAFA;AAKA;AACA;AACA;AADA;AAGA;AACA;AACA;AACA;AACA;AACA;AAHA;AADA;AAOA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AADA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AADA;AAGA;AACA;AACA;AADA;AAGA;;;;;;;;;ACxEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;ACPA;;;A","sourceRoot":""}