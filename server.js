module.exports=function(e){function r(o){if(n[o])return n[o].exports;var s=n[o]={i:o,l:!1,exports:{}};return e[o].call(s.exports,s,s.exports,r),s.l=!0,s.exports}var n={};return r.m=e,r.c=n,r.d=function(e,n,o){r.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:o})},r.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(n,"a",n),n},r.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},r.p="",r(r.s=5)}([function(e,r){e.exports=require("mongoose")},function(e,r){e.exports=require("jsonwebtoken")},function(e,r){e.exports=require("bcrypt")},function(e,r){e.exports=require("express")},function(e,r){e.exports=require("path")},function(e,r,n){"use strict";var o=n(0);n(1);n(6).config({path:"variables.env"}),o.Promise=global.Promise,o.connect(process.env.DATABASE),o.connection.on("error",function(e){console.error("!!!!!!!ERROR!!!!!!! -> "+e.message)}),n(7);var s=n(8);s.set("port",process.env.SERVER_PORT||7777);var t=s.listen(s.get("port"),function(){console.log("Express running -> PORT "+t.address().port)})},function(e,r){e.exports=require("dotenv")},function(e,r,n){"use strict";var o=n(0),s=n(2),t=o.Schema({username:{type:String,trim:!0,unique:!0,required:!0},email:{type:String,unique:!0,lowercase:!0,trim:!0,required:!0},hash_password:{type:String},created:{type:Date,default:Date.now}});t.methods.comparePassword=function(e){return s.compareSync(e,this.hash_password)},o.model("User",t)},function(e,r,n){"use strict";var o=n(3),s=n(9),t=n(10),i=n(13),u=n(4);process.env.BUILD_DEV&&i.install();var a=o();a.use(s.json()),a.use(s.urlencoded({extended:!0})),a.use("/download/assets",o.static(u.join(process.cwd(),"assets"))),a.use("/",t),e.exports=a},function(e,r){e.exports=require("body-parser")},function(e,r,n){"use strict";var o=n(3).Router(),s=n(11),t=n(12);o.use(s.decodeJWT),o.post("/account/register",s.register),o.post("/account/login",s.login),o.get("/account/isloggedin",s.isLoggedIn),o.get("/download/:filename",t.download),e.exports=o},function(e,r,n){"use strict";var o=n(0),s=n(1),t=n(2),i=o.model("User");r.register=function(e,r){var n=new i(e.body);n.hash_password=t.hashSync(e.body.password,10),n.save().then(function(e){e.hash_password=void 0,r.json(e)}).catch(function(e){return r.status(400).json({message:e})})},r.login=function(e,r){i.findOne({username:e.body.username}).then(function(n){return n&&n.comparePassword(e.body.password)?r.json({token:s.sign({email:n.email,username:n.username,_id:n._id},"secret_key")}):r.status(401).json({message:"Authentication failed. Invalid user or password."})}).catch(console.error)},r.loginRequired=function(e,r,n){if(!e.user)return r.status(401).json({message:"You are not logged in !"});n()},r.decodeJWT=function(e,r,n){e.headers&&e.headers.authorization&&"JWT"===e.headers.authorization.split(" ")[0]?s.verify(e.headers.authorization.split(" ")[1],"secret_key",function(r,o){r&&(e.user=void 0),e.user=o,n()}):(e.user=void 0,n())},r.isLoggedIn=function(e,r){if(!e.user)return r.status(401).json({isLoggedIn:!1});r.json({isLoggedIn:!0})}},function(e,r,n){"use strict";var o=n(4);r.download=function(e,r,n){r.download(o.resolve(process.cwd(),"dist/"+e.params.filename),function(r){if(r)return n(r);console.log(e.params.filename+" sent")})}},function(e,r){e.exports=require("source-map-support")}]);
//# sourceMappingURL=server.js.map